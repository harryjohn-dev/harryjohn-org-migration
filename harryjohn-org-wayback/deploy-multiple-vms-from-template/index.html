<!DOCTYPE html>
<html lang="en-US" class="no-js" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://www.harryjohn.org/xmlrpc.php" />



<!-- This site is optimized with the Yoast SEO plugin v4.4 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Deploy multiple VMs from template with PowerCLI</title>
<link rel="canonical" href="http://www.harryjohn.org/deploy-multiple-vms-from-template/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Deploy multiple VMs from template with PowerCLI" />
<meta property="og:description" content="I frequently need to deploy multiple VMs from a template in large numbers, most often a bunch of Citrix XenApp or XenDesktop servers following an update to the gold image. Without an automated method deployment can become a headache and would take days to deploy multiple VMs, especially when taking into account the post-deploy tasks &hellip;" />
<meta property="og:url" content="http://www.harryjohn.org/deploy-multiple-vms-from-template/" />
<meta property="og:site_name" content="Harry John" />
<meta property="article:tag" content="deployment" />
<meta property="article:tag" content="PowerCLI" />
<meta property="article:tag" content="scripts" />
<meta property="article:tag" content="VMware" />
<meta property="article:section" content="PowerCLI" />
<meta property="article:published_time" content="2014-01-06T15:27:36+00:00" />
<meta property="article:modified_time" content="2014-01-07T21:55:30+00:00" />
<meta property="og:updated_time" content="2014-01-07T21:55:30+00:00" />
<meta property="og:image" content="http://www.harryjohn.org/wp-content/uploads/2014/01/deploy-multiple-vms-from-template-300x211.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Harry John &raquo; Feed" href="http://www.harryjohn.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="Harry John &raquo; Comments Feed" href="http://www.harryjohn.org/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Harry John &raquo; Deploy multiple VMs from template with PowerCLI Comments Feed" href="http://www.harryjohn.org/deploy-multiple-vms-from-template/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.harryjohn.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.8"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='http://www.harryjohn.org/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='http://www.harryjohn.org/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://www.harryjohn.org/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='infosource_style-css'  href='http://www.harryjohn.org/wp-content/themes/infosource/style.css?ver=4.7.8' type='text/css' media='all' />
<link rel='stylesheet' id='easy_table_style-css'  href='http://www.harryjohn.org/wp-content/plugins/easy-table/themes/default/style.css?ver=1.5.3' type='text/css' media='all' />
<!-- This site uses the Google Analytics by MonsterInsights plugin v6.0.16 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-38803066-1', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('send','pageview');
</script>
<!-- / Google Analytics by MonsterInsights -->
<script type='text/javascript' src='http://www.harryjohn.org/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://www.harryjohn.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/www.harryjohn.org\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.harryjohn.org/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='http://www.harryjohn.org/wp-content/themes/infosource/library/js/modernizr-2.6.2.min.js?ver=2.6.2'></script>
<script type='text/javascript' src='http://www.harryjohn.org/wp-content/themes/infosource/library/js/scripts.js?ver=1.0.0'></script>
<link rel='https://api.w.org/' href='http://www.harryjohn.org/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.harryjohn.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.harryjohn.org/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.7.8" />
<link rel='shortlink' href='http://www.harryjohn.org/?p=204' />
<link rel="alternate" type="application/json+oembed" href="http://www.harryjohn.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.harryjohn.org%2Fdeploy-multiple-vms-from-template%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://www.harryjohn.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.harryjohn.org%2Fdeploy-multiple-vms-from-template%2F&#038;format=xml" />
<script type='text/javascript'>
var e_mailit_config = {display_counter:false,follow_services:{},thanks_message:'Thanks for sharing!',mobile_bar:true,after_share_dialog:true,display_ads:true,hover_pinit:false,open_on:'onclick',emailit_branding:true,headline:[]};(function() {	var b=document.createElement('script');	
                        b.type='text/javascript';b.async=true;
	
                        b.src='//www.e-mailit.com/widget/menu3x/js/button.js';
	
                        var c=document.getElementsByTagName('head')[0];	c.appendChild(b) })()</script>
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type="text/css" id="custom-background-css">
body.custom-background { background-image: url("http://www.harryjohn.org/wp-content/themes/infosource/library/images/bg.jpg"); background-position: left top; background-size: auto; background-repeat: repeat; background-attachment: scroll; }
</style>
</head>

<body class="post-template-default single single-post postid-204 single-format-standard custom-background single-author">

<header id="branding" role="banner">
  <div id="inner-header" class="clearfix">
    <div id="site-heading">
        <div id="site-title"><a href="http://www.harryjohn.org/" title="Harry John" rel="home">Harry John</a></div>
    </div>
    <form role="search" method="get" id="searchform" class="searchform" action="http://www.harryjohn.org/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>  </div>
  
  <nav id="access" role="navigation">
  	<div id="inner-nav" class="clearfix">
        <h1 class="assistive-text section-heading">Main menu</h1>
        <div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
        <div class="menu"><ul><li ><a href="http://www.harryjohn.org/">Home</a></li><li class="page_item page-item-5"><a href="http://www.harryjohn.org/about/">About</a></li></ul></div>    </div>
  </nav><!-- #access -->
</header><!-- #branding -->

<div id="container">

    <div id="content" class="clearfix">
        
        <div id="main" class="col620 clearfix" role="main">

			
				
<article id="post-204" class="post-204 post type-post status-publish format-standard hentry category-powercli category-vmware tag-deployment tag-powercli tag-scripts tag-vmware">
	<div class="post-meta-style">
        <div class="post-date-style"><a href="http://www.harryjohn.org/deploy-multiple-vms-from-template/" rel="bookmark">Jan 06, 2014</a></div>
        <p class="post-author-style">by <a class="url fn n" href="http://www.harryjohn.org/author/harry/" title="View all posts by Harry John" rel="author">Harry John</a></p><p class="post-cat-style">in <a href="http://www.harryjohn.org/category/powercli/" rel="tag">PowerCLI</a>, <a href="http://www.harryjohn.org/category/vmware/" rel="tag">VMware</a></p>            
       				<p class="post-comment-style"><a href="http://www.harryjohn.org/deploy-multiple-vms-from-template/#comments"><span class="white">Comment</span> (1)</a></p>
		    </div>
<div class="content-wrap">
  <div class="post-wrap">
    	<header class="entry-header">
		<h1 class="entry-title">Deploy multiple VMs from template with PowerCLI</h1>
	</header><!-- .entry-header -->
    
	<div class="entry-content post_content">
		<div class="e-mailit_top_toolbox"><div class="e-mailit_toolbox square size32 " data-emailit-url='http://www.harryjohn.org/deploy-multiple-vms-from-template/' data-emailit-title='Deploy multiple VMs from template with PowerCLI'>
<div class="e-mailit_btn_Facebook"></div>
<div class="e-mailit_btn_Twitter"></div>
<div class="e-mailit_btn_Send_via_Email"></div>
<div class="e-mailit_btn_Pinterest"></div>
<div class="e-mailit_btn_LinkedIn"></div>
<div class="e-mailit_btn_EMAILiT"></div></div>
</div><p><a href="http://www.harryjohn.org/wp-content/uploads/2014/01/deploy-multiple-vms-from-template.png"><img class="alignright size-medium wp-image-231" alt="Deploy multiple VMs from template" src="http://www.harryjohn.org/wp-content/uploads/2014/01/deploy-multiple-vms-from-template-300x211.png" width="300" height="211" srcset="http://www.harryjohn.org/wp-content/uploads/2014/01/deploy-multiple-vms-from-template-300x211.png 300w, http://www.harryjohn.org/wp-content/uploads/2014/01/deploy-multiple-vms-from-template-624x439.png 624w, http://www.harryjohn.org/wp-content/uploads/2014/01/deploy-multiple-vms-from-template.png 749w" sizes="(max-width: 300px) 100vw, 300px" /></a>I frequently need to deploy multiple VMs from a template in large numbers, most often a bunch of Citrix XenApp or XenDesktop servers following an update to the gold image. Without an automated method deployment can become a headache and would take days to deploy multiple VMs, especially when taking into account the post-deploy tasks such as activating Windows, activating Office, installing Citrix, putting the computer into the right OU etc.</p>
<p>Rather than consuming large amounts of paracetamol I have written a (fairly long) PowerCLI script to remove as many of the manual and mundane tasks as I could. In this blog post I am going to run through the script and explain how it works. You may download the complete script and use it &#8220;out-the-box&#8221; or make your own modifications, otherwise read on to understand how I deploy multiple VMs from template using PowerCLI.<span id="more-204"></span></p>
<p>The script currently does the following:</p>
<ul>
<li>Deploys multiple VMs from template</li>
<li>Chooses the best datastores to deploy multiple VMs based on capacity and number of VMs/datastore</li>
<li>Powers on the VM</li>
<li>Puts the VM in the correct OU within AD</li>
<li>Activates Windows</li>
<li>Activates Office</li>
<li>Changes IP address</li>
<li>Starts a custom service (I used this to start IMA service which adds the VM to Citrix AppCenter)</li>
</ul>
<p>The complete script is currently approximately 700 lines in total and you can <a href="http://www.harryjohn.org/wp-content/uploads/2014/01/DeployMultipleVMs1.zip">download the complete script</a>, however for the educational purpose of this article I will just go through some major snippets. Hopefully this will help give you some ideas or to understand the basics of how this works.</p>
<p>In this blog post I will cover the following aspects of the script:</p>
<ul>
<li>How to deploy multiple VMs from template simultaneously</li>
<li>Keeping track of VMs as they go through the build process</li>
<li>Changing the IP address of a VM once deployed</li>
</ul>
<h2>Deploy multiple VMs from template simultaneously</h2>
<p>To deploy multiple VMs from template simultaneously I make use of <a href="http://blogs.technet.com/b/heyscriptingguy/archive/2012/12/31/using-windows-powershell-jobs.aspx">PowerShell Jobs</a>. For a complete understanding of how this works read through ScriptingGuy&#8217;s excellent blog post. I will be using just two of these commands; Start-Job and Get-Job</p>
<p>Now, when invoking the Start-Job command a new hidden PowerShell instance will be launched in the background and runs the job within here. There are a few things to note;</p>
<ol>
<li>A new PowerCLI instance means a new session to vCenter, you will need to forward the current session to each instance/job you start</li>
<li>If you have a PowerShell profile script, this script will run for each instance/job you start</li>
</ol>
<p>I am not going to cover <a href="http://velemental.com/2012/03/11/multithreading-powercli/">Multi-threading PowerCLI</a> as this has been explained very well on the vElemental blog, I suggest you check it out for a full understanding of how this works. For now just know that I will be using two .ps1 files &#8211; the &#8220;deploy VM script&#8221; which will be invoked by what I like to call the &#8220;control script&#8221;, every time we want to deploy another VM simultaneously.</p>
<h2>The deploy VM script</h2>
<p>This script is simple. Other than the bit of work required in passing the vCenter session credentials over from the &#8220;control script&#8221;, all we need to do here is create a mini PowerCLI script to deploy one VM. So first, lets gather some parameters about the VM we are to deploy:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f12c953320872" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Param ($session=$(throw "missing -session parameter"),$vcserver,$name,$datastore,$ipaddr,$template,$folderName)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f12c953320872-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f12c953320872-1"><span class="crayon-st">Param</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$session</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-s">"missing -session parameter"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-v">$vcserver</span><span class="crayon-sy">,</span><span class="crayon-v">$name</span><span class="crayon-sy">,</span><span class="crayon-v">$datastore</span><span class="crayon-sy">,</span><span class="crayon-v">$ipaddr</span><span class="crayon-sy">,</span><span class="crayon-v">$template</span><span class="crayon-sy">,</span><span class="crayon-v">$folderName</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>There are just a few more parameters I will need, the host/cluster I am to deploy to, the customisation spec and the true VMware folder location:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f137046219097" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#========================================================================
# PARAMETERS
#========================================================================
# host/cluster
$vmhost = "cluster1"

# customisation spec
$custSpecName = "W2K8-R2-X64"

# location
$folder = Get-Folder -Location "Virtual Machines" -Name $folderName</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f137046219097-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f137046219097-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f137046219097-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f137046219097-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f137046219097-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f137046219097-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f137046219097-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f137046219097-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f137046219097-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f137046219097-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f137046219097-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f137046219097-1"><span class="crayon-c">#========================================================================</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f137046219097-2"><span class="crayon-c"># PARAMETERS</span></div><div class="crayon-line" id="crayon-5a56046b0f137046219097-3"><span class="crayon-c">#========================================================================</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f137046219097-4"><span class="crayon-c"># host/cluster</span></div><div class="crayon-line" id="crayon-5a56046b0f137046219097-5"><span class="crayon-v">$vmhost</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"cluster1"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f137046219097-6">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f137046219097-7"><span class="crayon-c"># customisation spec</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f137046219097-8"><span class="crayon-v">$custSpecName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"W2K8-R2-X64"</span></div><div class="crayon-line" id="crayon-5a56046b0f137046219097-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f137046219097-10"><span class="crayon-c"># location</span></div><div class="crayon-line" id="crayon-5a56046b0f137046219097-11"><span class="crayon-v">$folder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">Get-Folder</span><span class="crayon-h"> </span><span class="crayon-cn">-Location</span><span class="crayon-h"> </span><span class="crayon-s">"Virtual Machines"</span><span class="crayon-h"> </span><span class="crayon-cn">-Name</span><span class="crayon-h"> </span><span class="crayon-v">$folderName</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>There is something important to note about customisation specs. I have set my customisation spec to use DHCP and I will be applying a static IP once the VM has deployed, powered on and been customised. One method many people have discussed is to clone your main customisation spec into a new &#8220;temporary spec&#8221;, add the IP address details into this temporary spec and delete after you have deployed a VM with it. I just didn&#8217;t get along with this method. It would be nice if there was a way we could supply the details within PowerCLI for which you are prompted for when using the vSphere Client, as far as I know this is not possible.</p>
<p>Finally, we need the command to deploy a VM using the parameters we have collected above.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f141261100978" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
try {
$vm = New-VM -Name $name `
	-VMHost $vmhost `
	-Template $template `
	-OSCustomizationSpec $custSpec `
	-Datastore $datastore `
	-Location $folder `
	-ErrorAction:Stop
}
catch
{
# your catch method....
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f141261100978-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f141261100978-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f141261100978-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f141261100978-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f141261100978-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f141261100978-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f141261100978-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f141261100978-1"><span class="crayon-e">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f141261100978-2"><span class="crayon-v">$vm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">New-VM</span><span class="crayon-h"> </span><span class="crayon-cn">-Name</span><span class="crayon-h"> </span><span class="crayon-v">$name</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f141261100978-3"><span class="crayon-h">	</span><span class="crayon-cn">-VMHost</span><span class="crayon-h"> </span><span class="crayon-v">$vmhost</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f141261100978-4"><span class="crayon-h">	</span><span class="crayon-cn">-Template</span><span class="crayon-h"> </span><span class="crayon-v">$template</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f141261100978-5"><span class="crayon-h">	</span><span class="crayon-cn">-OSCustomizationSpec</span><span class="crayon-h"> </span><span class="crayon-v">$custSpec</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f141261100978-6"><span class="crayon-h">	</span><span class="crayon-cn">-Datastore</span><span class="crayon-h"> </span><span class="crayon-v">$datastore</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f141261100978-7"><span class="crayon-h">	</span><span class="crayon-cn">-Location</span><span class="crayon-h"> </span><span class="crayon-v">$folder</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f141261100978-8"><span class="crayon-h">	</span><span class="crayon-cn">-ErrorAction</span><span class="crayon-o">:</span><span class="crayon-i">Stop</span></div><div class="crayon-line" id="crayon-5a56046b0f141261100978-9"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f141261100978-10"><span class="crayon-e">catch</span></div><div class="crayon-line" id="crayon-5a56046b0f141261100978-11"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f141261100978-12"><span class="crayon-c"># your catch method....</span></div><div class="crayon-line" id="crayon-5a56046b0f141261100978-13"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>That&#8217;s it for the deploy VM script, I told you it was simple!</p>
<h2>The control script</h2>
<p>Getting slightly more complicated, the control script is the &#8220;brain&#8221; of the process and, you guessed it, controls the deployment of multiple VMs as well as completing any other post-deployment tasks. Lets just cover the basics.</p>
<p>First we must gather some information about the VMs we are to deploy. Some information I like to &#8220;hard code&#8221; in parameters at the top of the script such as the template name, DNS servers and gateway address. Other information I like to collect interactively when at run-time such as VM names, IP addresses, number of VMs. Here is an example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f148493071767" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# HARD CODED PARAMETERS
# vm settings
$folder = "Citrix-NG Servers"
$template = 'Citrix XenApp 6.5 Farm Member Template (Citrix Installed)'

# network variables
$networkSubnet = "255.255.0.0"
$networkGateway = "172.16.0.1"
$networkDns = "172.16.0.2","172.16.0.3"

# GATHER FROM USER PARAMETERS
# get VM name prefix
$vmFirstName = Read-Host "Enter the name of the first VM (e.g. MAILSERVER01)"

# get number of VMs to build
[int]$vmQuantity = Read-Host "How many VMs are you deploying?"

# get IP Address 
$ipAddress = Read-Host "You need a block of $vmQuantity adjacent IP addresses, enter the first"</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-14">14</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-16">16</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f148493071767-18">18</div><div class="crayon-num" data-line="crayon-5a56046b0f148493071767-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f148493071767-1"><span class="crayon-c"># HARD CODED PARAMETERS</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-2"><span class="crayon-c"># vm settings</span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-3"><span class="crayon-v">$folder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"Citrix-NG Servers"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-4"><span class="crayon-v">$template</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Citrix XenApp 6.5 Farm Member Template (Citrix Installed)'</span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-6"><span class="crayon-c"># network variables</span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-7"><span class="crayon-v">$networkSubnet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"255.255.0.0"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-8"><span class="crayon-v">$networkGateway</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"172.16.0.1"</span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-9"><span class="crayon-v">$networkDns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"172.16.0.2"</span><span class="crayon-sy">,</span><span class="crayon-s">"172.16.0.3"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-10">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f148493071767-11"><span class="crayon-c"># GATHER FROM USER PARAMETERS</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-12"><span class="crayon-c"># get VM name prefix</span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-13"><span class="crayon-v">$vmFirstName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">Read-Host</span><span class="crayon-h"> </span><span class="crayon-s">"Enter the name of the first VM (e.g. MAILSERVER01)"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-14">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f148493071767-15"><span class="crayon-c"># get number of VMs to build</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-16"><span class="crayon-sy">[</span><span class="crayon-t">int</span><span class="crayon-sy">]</span><span class="crayon-v">$vmQuantity</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">Read-Host</span><span class="crayon-h"> </span><span class="crayon-s">"How many VMs are you deploying?"</span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f148493071767-18"><span class="crayon-c"># get IP Address </span></div><div class="crayon-line" id="crayon-5a56046b0f148493071767-19"><span class="crayon-v">$ipAddress</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">Read-Host</span><span class="crayon-h"> </span><span class="crayon-s">"You need a block of $vmQuantity adjacent IP addresses, enter the first"</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>You might have already noticed, when I deploy multiple VMs they will have the same name but a different number at the end, for example; MAILSERVER01, MAILSERVER02 etc. I also deploy VMs with a sequence of adjacent IP addresses for example; 172.16.0.101, 172.16.0.102 etc. This makes deployment and this script very simple because all I need to know is the first VM name, the first IP address, and how many VMs to deploy. From this information I can create a nice PowerShell array with each VM name and its IP address. Lets split up the first IP address we have collected to do this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f150546407735" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split up IP address
$ipSplit = $ipAddress.Split(".")
$ipPrefix = $ipSplit[0] + "." + $ipSplit[1] + "." + $ipSplit[2] + "." 
[int]$ipSuffix = $ipSplit[3]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f150546407735-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f150546407735-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f150546407735-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f150546407735-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f150546407735-1"><span class="crayon-c"># split up IP address</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f150546407735-2"><span class="crayon-v">$ipSplit</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$ipAddress</span><span class="crayon-sy">.</span><span class="crayon-e">Split</span><span class="crayon-sy">(</span><span class="crayon-s">"."</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a56046b0f150546407735-3"><span class="crayon-v">$ipPrefix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$ipSplit</span><span class="crayon-sy">[</span>0<span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"."</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">$ipSplit</span><span class="crayon-sy">[</span>1<span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"."</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">$ipSplit</span><span class="crayon-sy">[</span>2<span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"."</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f150546407735-4"><span class="crayon-sy">[</span><span class="crayon-t">int</span><span class="crayon-sy">]</span><span class="crayon-v">$ipSuffix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$ipSplit</span><span class="crayon-sy">[</span>3<span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Now I have the IP address prefix, such as 172.16.0 and the first IP address suffix, such as 101. If I put together the prefix and the suffix I get the complete IP address: 172.16.0.101. I can add one to the suffix, put them together again and have the IP address of the next VM: 172.16.0.102. Simples!</p>
<p>Again, I need to do this with the VM name, so take the last two characters of the name and you have the first VM number (suffix), take the other characters and you have the VM name (prefix):</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f157448374595" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split up VM name
[int]$vmFirstNumber = $vmFirstName.Substring($vmFirstName.length - 2,2)
$vmNamePrefix = $vmFirstName.Substring(0,$vmFirstName.length - 2)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f157448374595-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f157448374595-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f157448374595-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f157448374595-1"><span class="crayon-c"># split up VM name</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f157448374595-2"><span class="crayon-sy">[</span><span class="crayon-t">int</span><span class="crayon-sy">]</span><span class="crayon-v">$vmFirstNumber</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmFirstName</span><span class="crayon-sy">.</span><span class="crayon-e">Substring</span><span class="crayon-sy">(</span><span class="crayon-v">$vmFirstName</span><span class="crayon-sy">.</span><span class="crayon-i">length</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span>2<span class="crayon-sy">,</span>2<span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a56046b0f157448374595-3"><span class="crayon-v">$vmNamePrefix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmFirstName</span><span class="crayon-sy">.</span><span class="crayon-e">Substring</span><span class="crayon-sy">(</span>0<span class="crayon-sy">,</span><span class="crayon-v">$vmFirstName</span><span class="crayon-sy">.</span><span class="crayon-i">length</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span>2<span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<h3>Keeping track of VMs as they go through the build process</h3>
<p>Now we have collected all the info we need to deploy multiple VMs, I like to create an array which will keep track of the VMs, tasks and their status. So lets create a loop to build the VM name and the IP address using the prefixes and suffixes we created earlier and add each one to the array. I also add a few other properties for each VM to keep track of the build status, such as Clone Initiated, Cloned, Powered On and Re-IP.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f15f963307050" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
###################
# Build $vmStatus array to keep track of VMs and completed tasks
###################

# create an object collection holding status info for all VMs being built
$vmStatus = @()

# create counters for VM name and IP address/datastore
$vmNumber = $vmFirstNumber
$vmCounter = 0

1..$vmQuantity | foreach {
	# if VM number is less than 10 add a 0 onto the server name so we dont have MAILSERVER1 for example
	if ($vmNumber -lt 10) {
		$vmName = $vmNamePrefix + "0" + $vmNumber
	} else {
		$vmName = $vmNamePrefix + $vmNumber
	}

	# compile IP address
        $vmIpAddress = $ipPrefix + ($ipSuffix + ($vmCounter))

	# setup object properties
	$properties = [ordered]@{
		MachineName = $vmName
		IpAddress = $vmIpAddress
		CloneInitiated = 0
		Cloned = 0
		PoweredOn = 0
		ReIP = 0
	}

	# create object and add to collection
	$obj = New-Object -TypeName PSObject -Property $properties
	$vmStatus += $obj

	# increase counters
	$vmNumber++
	$vmCounter++
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-14">14</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-16">16</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-18">18</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-20">20</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-22">22</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-24">24</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-26">26</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-28">28</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-30">30</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-32">32</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-34">34</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-36">36</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-38">38</div><div class="crayon-num" data-line="crayon-5a56046b0f15f963307050-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f15f963307050-40">40</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f15f963307050-1"><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-2"><span class="crayon-c"># Build $vmStatus array to keep track of VMs and completed tasks</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-3"><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-4">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-5"><span class="crayon-c"># create an object collection holding status info for all VMs being built</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-6"><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-8"><span class="crayon-c"># create counters for VM name and IP address/datastore</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-9"><span class="crayon-v">$vmNumber</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmFirstNumber</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-10"><span class="crayon-v">$vmCounter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>0</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-12">1<span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-v">$vmQuantity</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-13"><span class="crayon-h">	</span><span class="crayon-c"># if VM number is less than 10 add a 0 onto the server name so we dont have MAILSERVER1 for example</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-14"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$vmNumber</span><span class="crayon-h"> </span><span class="crayon-cn">-lt</span><span class="crayon-h"> </span>10<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-15"><span class="crayon-h">		</span><span class="crayon-v">$vmName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmNamePrefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">$vmNumber</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-16"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-17"><span class="crayon-h">		</span><span class="crayon-v">$vmName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmNamePrefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">$vmNumber</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-18"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-20"><span class="crayon-h">	</span><span class="crayon-c"># compile IP address</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$vmIpAddress</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$ipPrefix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$ipSuffix</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$vmCounter</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-22">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-23"><span class="crayon-h">	</span><span class="crayon-c"># setup object properties</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-24"><span class="crayon-h">	</span><span class="crayon-v">$properties</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">ordered</span><span class="crayon-sy">]</span><span class="crayon-sy">@</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-25"><span class="crayon-h">		</span><span class="crayon-i">MachineName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmName</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-26"><span class="crayon-h">		</span><span class="crayon-i">IpAddress</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmIpAddress</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-27"><span class="crayon-h">		</span><span class="crayon-i">CloneInitiated</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>0</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-28"><span class="crayon-h">		</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>0</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-29"><span class="crayon-h">		</span><span class="crayon-i">PoweredOn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>0</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-30"><span class="crayon-h">		</span><span class="crayon-i">ReIP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>0</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-31"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-32">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-33"><span class="crayon-h">	</span><span class="crayon-c"># create object and add to collection</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-34"><span class="crayon-h">	</span><span class="crayon-v">$obj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">New-Object</span><span class="crayon-h"> </span><span class="crayon-cn">-TypeName</span><span class="crayon-h"> </span><span class="crayon-t">PSObject</span><span class="crayon-h"> </span><span class="crayon-cn">-Property</span><span class="crayon-h"> </span><span class="crayon-v">$properties</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-35"><span class="crayon-h">	</span><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">$obj</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-36">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-37"><span class="crayon-h">	</span><span class="crayon-c"># increase counters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-38"><span class="crayon-h">	</span><span class="crayon-v">$vmNumber</span><span class="crayon-o">++</span></div><div class="crayon-line" id="crayon-5a56046b0f15f963307050-39"><span class="crayon-h">	</span><span class="crayon-v">$vmCounter</span><span class="crayon-o">++</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f15f963307050-40"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0050 seconds] -->
<p>This is a good start, we now have a list of VMs, their IP addresses and the status of deployment. You could modify the above to perhaps import a list from CSV, rather than ask for the VM details interactively. A good reason to do this would be if you wanted to deploy multiple VMs without following my naming convention or adjacent IP addresses.</p>
<p>Prepare the command to deploy a VM using the deploy VM script we created earlier. I also clear the current job list in case any are still in memory from a previous time I ran the script without reloading my PowerShell session:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f167097991859" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
###################
# Prepare to start deploying VMs
###################

# prepare VM deploy job command
$job= {
	Set-Location $args[0]
	powershell -command ".\DeployVM.ps1 -session $($args[1]) -vcserver $($args[2]) -name $($args[3]) -datastore $($args[4]) -ipaddr $($args[5]) -template `'$($args[6])`' -folder `'$($args[7])`'"
}

# clear job list
Get-Job | Remove-Job</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f167097991859-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f167097991859-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f167097991859-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f167097991859-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f167097991859-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f167097991859-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f167097991859-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f167097991859-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f167097991859-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f167097991859-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f167097991859-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f167097991859-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f167097991859-1"><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f167097991859-2"><span class="crayon-c"># Prepare to start deploying VMs</span></div><div class="crayon-line" id="crayon-5a56046b0f167097991859-3"><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f167097991859-4">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f167097991859-5"><span class="crayon-c"># prepare VM deploy job command</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f167097991859-6"><span class="crayon-v">$job</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f167097991859-7"><span class="crayon-h">	</span><span class="crayon-r ">Set-Location</span><span class="crayon-h"> </span><span class="crayon-v">$args</span><span class="crayon-sy">[</span>0<span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f167097991859-8"><span class="crayon-h">	</span><span class="crayon-i">powershell</span><span class="crayon-h"> </span><span class="crayon-cn">-command</span><span class="crayon-h"> </span><span class="crayon-s">".\DeployVM.ps1 -session $($args[1]) -vcserver $($args[2]) -name $($args[3]) -datastore $($args[4]) -ipaddr $($args[5]) -template `'$($args[6])`' -folder `'$($args[7])`'"</span></div><div class="crayon-line" id="crayon-5a56046b0f167097991859-9"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f167097991859-10">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f167097991859-11"><span class="crayon-c"># clear job list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f167097991859-12"><span class="crayon-r ">Get-Job</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-r ">Remove-Job</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Time to start deploying multiple VMs! The following loop will continue looping until all tasks have been completed, that is all the properties for each VM within $vmStatus have a value of 1. Notice in the next few examples before each task I select the VMs which have not yet had that task completed and where previous tasks have been completed using a where query on $vmStatus. If the task then completes successfully, I set that property to 1.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f16e449678172" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
while ($vmsCompleted.Count -lt $vmQuantity) {

	###################
	# Initiate VM cloning, using $maxConcurrentJobs as the limit
	###################

	# do not start job if $maxConcurrentJobs are already running, do not start if all VMs are now cloned (clone initiated) - skip this task
	if (($vmsCloneInitiated.Count -lt $vmQuantity) -and ($runningJobCount -lt $maxConcurrentJobs)) {

        # select VMs which have not yet been cloned - and only the first $maxConcurrentJobs VMs
        $vmStatus | where {($_.Cloned -eq 0)} | Select-Object -first $maxConcurrentJobs | foreach {

		    # create job
		    Start-Job -Name $_.MachineName -ScriptBlock $job -ArgumentList $currentPath, $session, $vcserver, $_.MachineName, $_.Datastore, $_.IpAddress, $template, $folder		

		    # update vmStatus object collection
		    $_.CloneInitiated = 1
        }
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-14">14</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-16">16</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f16e449678172-18">18</div><div class="crayon-num" data-line="crayon-5a56046b0f16e449678172-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f16e449678172-1"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$vmsCompleted</span><span class="crayon-sy">.</span><span class="crayon-i">Count</span><span class="crayon-h"> </span><span class="crayon-cn">-lt</span><span class="crayon-h"> </span><span class="crayon-v">$vmQuantity</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-2">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-3"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-4"><span class="crayon-h">	</span><span class="crayon-c"># Initiate VM cloning, using $maxConcurrentJobs as the limit</span></div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-5"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-6">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-7"><span class="crayon-h">	</span><span class="crayon-c"># do not start job if $maxConcurrentJobs are already running, do not start if all VMs are now cloned (clone initiated) - skip this task</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-8"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">$vmsCloneInitiated</span><span class="crayon-sy">.</span><span class="crayon-i">Count</span><span class="crayon-h"> </span><span class="crayon-cn">-lt</span><span class="crayon-h"> </span><span class="crayon-v">$vmQuantity</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$runningJobCount</span><span class="crayon-h"> </span><span class="crayon-cn">-lt</span><span class="crayon-h"> </span><span class="crayon-v">$maxConcurrentJobs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># select VMs which have not yet been cloned - and only the first $maxConcurrentJobs VMs</span></div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">where</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-r ">Select-Object</span><span class="crayon-h"> </span><span class="crayon-cn">-first</span><span class="crayon-h"> </span><span class="crayon-v">$maxConcurrentJobs</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-12">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-13"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># create job</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-14"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">Start-Job</span><span class="crayon-h"> </span><span class="crayon-cn">-Name</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span><span class="crayon-h"> </span><span class="crayon-cn">-ScriptBlock</span><span class="crayon-h"> </span><span class="crayon-v">$job</span><span class="crayon-h"> </span><span class="crayon-cn">-ArgumentList</span><span class="crayon-h"> </span><span class="crayon-v">$currentPath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$session</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$vcserver</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">Datastore</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">IpAddress</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$template</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$folder</span><span class="crayon-h">		</span></div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-16"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># update vmStatus object collection</span></div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-17"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">CloneInitiated</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>1</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f16e449678172-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a56046b0f16e449678172-19"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>There are a few variables in the above example I have not yet mentioned, such as $vmsComplete.Count, $vmsCloneInitiated.Count and $runningJobCount. Lets update these</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f175674389632" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	###################
	# Check running job count and look for VMs which have finished cloning
	###################

	# count current running jobs
	$jobs = Get-Job 
	$runningJobs = $jobs | ? { $_.state -eq "Running" }
	$runningJobCount = $runningJobs.count

	# check for vms which have finished cloning
	$completedJobs = $jobs | ? { $_.state -eq "Completed" }	

	# update $vmStatus
	foreach ($completedJob in $completedJobs) {

		# get index of object and set cloned to 1
		$vmStatusIndex = 0..($vmStatus.Count -1) | where {$vmStatus[$_].MachineName -eq $completedJob.Name}
		$vmStatus[$vmStatusIndex].Cloned = 1
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-14">14</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-16">16</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f175674389632-18">18</div><div class="crayon-num" data-line="crayon-5a56046b0f175674389632-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f175674389632-1"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-2"><span class="crayon-h">	</span><span class="crayon-c"># Check running job count and look for VMs which have finished cloning</span></div><div class="crayon-line" id="crayon-5a56046b0f175674389632-3"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-4">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f175674389632-5"><span class="crayon-h">	</span><span class="crayon-c"># count current running jobs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-6"><span class="crayon-h">	</span><span class="crayon-v">$jobs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r ">Get-Job</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5a56046b0f175674389632-7"><span class="crayon-h">	</span><span class="crayon-v">$runningJobs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$jobs</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">state</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span><span class="crayon-s">"Running"</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-8"><span class="crayon-h">	</span><span class="crayon-v">$runningJobCount</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$runningJobs</span><span class="crayon-sy">.</span><span class="crayon-i">count</span></div><div class="crayon-line" id="crayon-5a56046b0f175674389632-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-10"><span class="crayon-h">	</span><span class="crayon-c"># check for vms which have finished cloning</span></div><div class="crayon-line" id="crayon-5a56046b0f175674389632-11"><span class="crayon-h">	</span><span class="crayon-v">$completedJobs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$jobs</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">state</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span><span class="crayon-s">"Completed"</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h">	</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-12">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f175674389632-13"><span class="crayon-h">	</span><span class="crayon-c"># update $vmStatus</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-14"><span class="crayon-h">	</span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$completedJob</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">$completedJobs</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f175674389632-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-16"><span class="crayon-h">		</span><span class="crayon-c"># get index of object and set cloned to 1</span></div><div class="crayon-line" id="crayon-5a56046b0f175674389632-17"><span class="crayon-h">		</span><span class="crayon-v">$vmStatusIndex</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>0<span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">(</span><span class="crayon-v">$vmStatus</span><span class="crayon-sy">.</span><span class="crayon-i">Count</span><span class="crayon-h"> </span><span class="crayon-cn">-1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">where</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">$vmStatus</span><span class="crayon-sy">[</span><span class="crayon-v">$_</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span><span class="crayon-v">$completedJob</span><span class="crayon-sy">.</span><span class="crayon-i">Name</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f175674389632-18"><span class="crayon-h">		</span><span class="crayon-v">$vmStatus</span><span class="crayon-sy">[</span><span class="crayon-v">$vmStatusIndex</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>1</div><div class="crayon-line" id="crayon-5a56046b0f175674389632-19"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0037 seconds] -->
<p>Finally, the rest of the loop to complete the remaining tasks. I have stripped out much of the code within each task to keep this looking simple for the purpose of the article.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f17e671646460" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	###################
	# Power on VMs which have finished cloning
	###################

	$vmStatus | where {($_.Cloned -ne 0) -and ($_.PoweredOn -eq 0)} | foreach {

		# start the VM
		Start-VM $_.MachineName

		# update $vmStatus
		$_.PoweredOn = 1
	}	

	###################
	# Set correct IP address for VMs and start Citrix service
	###################

	$vmStatus | where {($_.Cloned -ne 0) -and ($_.PoweredOn -ne 0) -and ($_.ReIP -eq 0)} | foreach {

		# check machine is online
		if (Test-Connection $_.MachineName -Count 1 -ErrorAction SilentlyContinue) {

            # code to set IP address - mentioned later in blog post
		}
	}

	###################
	# Update counters and sleep
	###################

	# update counters
	[ARRAY]$vmsCloneInitiated = $vmStatus | ? CloneInitiated -eq 1
	[ARRAY]$vmsCompleted = $vmStatus | ? {($_.Cloned -ne 0) -and ($_.PoweredOn -ne 0) -and ($_.ReIP -ne 0)}

	# sleep for $cycleTime seconds
	Start-Sleep $cycleTime
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-14">14</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-16">16</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-18">18</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-20">20</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-22">22</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-24">24</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-26">26</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-28">28</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-30">30</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-32">32</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-34">34</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f17e671646460-36">36</div><div class="crayon-num" data-line="crayon-5a56046b0f17e671646460-37">37</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f17e671646460-1"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-2"><span class="crayon-h">	</span><span class="crayon-c"># Power on VMs which have finished cloning</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-3"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-4">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-5"><span class="crayon-h">	</span><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">where</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">PoweredOn</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-6">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-7"><span class="crayon-h">		</span><span class="crayon-c"># start the VM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-8"><span class="crayon-h">		</span><span class="crayon-r ">Start-VM</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-10"><span class="crayon-h">		</span><span class="crayon-c"># update $vmStatus</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-11"><span class="crayon-h">		</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">PoweredOn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>1</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-12"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h">	</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-14"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-15"><span class="crayon-h">	</span><span class="crayon-c"># Set correct IP address for VMs and start Citrix service</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-16"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-18"><span class="crayon-h">	</span><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">where</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">PoweredOn</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">ReIP</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-20"><span class="crayon-h">		</span><span class="crayon-c"># check machine is online</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-21"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r ">Test-Connection</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span><span class="crayon-h"> </span><span class="crayon-cn">-Count</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span><span class="crayon-cn">-ErrorAction</span><span class="crayon-h"> </span><span class="crayon-i">SilentlyContinue</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-22">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># code to set IP address - mentioned later in blog post</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-24"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-25"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-26">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-27"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-28"><span class="crayon-h">	</span><span class="crayon-c"># Update counters and sleep</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-29"><span class="crayon-h">	</span><span class="crayon-c">###################</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-30">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-31"><span class="crayon-h">	</span><span class="crayon-c"># update counters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-32"><span class="crayon-h">	</span><span class="crayon-sy">[</span><span class="crayon-t">ARRAY</span><span class="crayon-sy">]</span><span class="crayon-v">$vmsCloneInitiated</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-i">CloneInitiated</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span>1</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-33"><span class="crayon-h">	</span><span class="crayon-sy">[</span><span class="crayon-t">ARRAY</span><span class="crayon-sy">]</span><span class="crayon-v">$vmsCompleted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">PoweredOn</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">ReIP</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-34">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-35"><span class="crayon-h">	</span><span class="crayon-c"># sleep for $cycleTime seconds</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f17e671646460-36"><span class="crayon-h">	</span><span class="crayon-r ">Start-Sleep</span><span class="crayon-h"> </span><span class="crayon-v">$cycleTime</span></div><div class="crayon-line" id="crayon-5a56046b0f17e671646460-37"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0062 seconds] -->
<p></p>
<h2>Changing the IP address of a VM once deployed</h2>
<p>I mentioned earlier I didn&#8217;t get along with the guest customisation method of setting the VM&#8217;s IP address. In the example above you can see where I set the IP address &#8211; one of the last things I do. I removed the code snippet for clarity in the article but here it is. Note, I also flush DNS and wait 15 seconds before continuing:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5a56046b0f186313510163" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PowerShell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$vmStatus | where {($_.Cloned -ne 0) -and ($_.PoweredOn -ne 0) -and ($_.InAD -ne 0) -and ($_.ActivateWin -ne 0) -and ($_.ActivateOffice -ne 0) -and ($_.ReIP -eq 0)} | foreach {

		# check machine is online
		if (Test-Connection $_.MachineName -Count 1 -ErrorAction SilentlyContinue) {

			Write-Host "$($_.MachineName): Online, changing IP address"

			# change IP settings
			try {
				Get-VM -Name $_.MachineName | Get-VMGuestNetworkInterface `
					-Guestuser $localAdminUser `
					-GuestPassword $localAdminPassword | `
						? { $_.name -like $localNICNameQuery } | `
							Set-VMGuestNetworkInterface `
								-Guestuser $localAdminUser `
								-GuestPassword $localAdminPassword `
								-IPPolicy static `
								-IP $_.IpAddress `
								-Netmask $networkSubnet  `
								-Gateway $networkGateway `
								-DNS $networkDns

				Write-Host "$($_.MachineName): IP Address changed"

				# flush dns
				ipconfig /flushdns
                Start-Sleep 15

        		# update $vmStatus	
				$_.ReIP = 1
			}
			catch {
                $null
			}
		}
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-2">2</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-4">4</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-6">6</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-8">8</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-10">10</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-12">12</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-14">14</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-16">16</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-18">18</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-20">20</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-22">22</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-24">24</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-26">26</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-28">28</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-30">30</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-32">32</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-34">34</div><div class="crayon-num" data-line="crayon-5a56046b0f186313510163-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a56046b0f186313510163-36">36</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a56046b0f186313510163-1"><span class="crayon-v">$vmStatus</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">where</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">Cloned</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">PoweredOn</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">InAD</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">ActivateWin</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">ActivateOffice</span><span class="crayon-h"> </span><span class="crayon-cn">-ne</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-cn">-and</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">ReIP</span><span class="crayon-h"> </span><span class="crayon-cn">-eq</span><span class="crayon-h"> </span>0<span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-2">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f186313510163-3"><span class="crayon-h">		</span><span class="crayon-c"># check machine is online</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-4"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r ">Test-Connection</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span><span class="crayon-h"> </span><span class="crayon-cn">-Count</span><span class="crayon-h"> </span>1<span class="crayon-h"> </span><span class="crayon-cn">-ErrorAction</span><span class="crayon-h"> </span><span class="crayon-i">SilentlyContinue</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-6"><span class="crayon-h">			</span><span class="crayon-r ">Write-Host</span><span class="crayon-h"> </span><span class="crayon-s">"$($_.MachineName): Online, changing IP address"</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-8"><span class="crayon-h">			</span><span class="crayon-c"># change IP settings</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-9"><span class="crayon-h">			</span><span class="crayon-e">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-10"><span class="crayon-h">				</span><span class="crayon-r ">Get-VM</span><span class="crayon-h"> </span><span class="crayon-cn">-Name</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">MachineName</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-r ">Get-VMGuestNetworkInterface</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-11"><span class="crayon-h">					</span><span class="crayon-cn">-Guestuser</span><span class="crayon-h"> </span><span class="crayon-v">$localAdminUser</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-12"><span class="crayon-h">					</span><span class="crayon-cn">-GuestPassword</span><span class="crayon-h"> </span><span class="crayon-v">$localAdminPassword</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-13"><span class="crayon-h">						</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">name</span><span class="crayon-h"> </span><span class="crayon-cn">-like</span><span class="crayon-h"> </span><span class="crayon-v">$localNICNameQuery</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-14"><span class="crayon-h">							</span><span class="crayon-r ">Set</span><span class="crayon-cn">-VMGuestNetworkInterface</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-15"><span class="crayon-h">								</span><span class="crayon-cn">-Guestuser</span><span class="crayon-h"> </span><span class="crayon-v">$localAdminUser</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-16"><span class="crayon-h">								</span><span class="crayon-cn">-GuestPassword</span><span class="crayon-h"> </span><span class="crayon-v">$localAdminPassword</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-17"><span class="crayon-h">								</span><span class="crayon-cn">-IPPolicy</span><span class="crayon-h"> </span><span class="crayon-i">static</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-18"><span class="crayon-h">								</span><span class="crayon-cn">-IP</span><span class="crayon-h"> </span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">IpAddress</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-19"><span class="crayon-h">								</span><span class="crayon-cn">-Netmask</span><span class="crayon-h"> </span><span class="crayon-v">$networkSubnet</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">`</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-20"><span class="crayon-h">								</span><span class="crayon-cn">-Gateway</span><span class="crayon-h"> </span><span class="crayon-v">$networkGateway</span><span class="crayon-h"> </span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-21"><span class="crayon-h">								</span><span class="crayon-cn">-DNS</span><span class="crayon-h"> </span><span class="crayon-v">$networkDns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-22">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f186313510163-23"><span class="crayon-h">				</span><span class="crayon-r ">Write-Host</span><span class="crayon-h"> </span><span class="crayon-s">"$($_.MachineName): IP Address changed"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-24">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f186313510163-25"><span class="crayon-h">				</span><span class="crayon-c"># flush dns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-26"><span class="crayon-h">				</span><span class="crayon-i">ipconfig</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-e">flushdns</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-27"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">Start-Sleep</span><span class="crayon-h"> </span>15</div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-28">&nbsp;</div><div class="crayon-line" id="crayon-5a56046b0f186313510163-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		</span><span class="crayon-c"># update $vmStatus	</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-30"><span class="crayon-h">				</span><span class="crayon-v">$_</span><span class="crayon-sy">.</span><span class="crayon-i">ReIP</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>1</div><div class="crayon-line" id="crayon-5a56046b0f186313510163-31"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-32"><span class="crayon-h">			</span><span class="crayon-e">catch</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$null</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-34"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5a56046b0f186313510163-35"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a56046b0f186313510163-36"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0068 seconds] -->
<p></p>
<h2>Conclusion</h2>
<p>That&#8217;s all folks! As I mentioned previously I have published the entire script for download but hopefully the above will give you a better understanding of how this works than reading the script alone. There are a few extra features in the full script which are not explained above, such as selecting an appropriate datastore for each VM auto-magically, activating Windows and Office and starting a Windows service. You can disable these features using the $enableFeature parameters at the top of script.</p>
<p>Did you find this useful? I&#8217;d love to hear your feedback, or if you are having any issues running the script or a variant of your own leave a commend and I will do my best to help!</p>
<div class="e-mailit_bottom_toolbox"><div class="e-mailit_toolbox square size32 " data-emailit-url='http://www.harryjohn.org/deploy-multiple-vms-from-template/' data-emailit-title='Deploy multiple VMs from template with PowerCLI'>
<div class="e-mailit_btn_Facebook"></div>
<div class="e-mailit_btn_Twitter"></div>
<div class="e-mailit_btn_Send_via_Email"></div>
<div class="e-mailit_btn_Pinterest"></div>
<div class="e-mailit_btn_LinkedIn"></div>
<div class="e-mailit_btn_EMAILiT"></div></div>
</div>			</div><!-- .entry-content -->

	<footer class="entry-meta">
		This entry was posted in <a href="http://www.harryjohn.org/category/powercli/" rel="tag">PowerCLI</a>, <a href="http://www.harryjohn.org/category/vmware/" rel="tag">VMware</a> and tagged <a href="http://www.harryjohn.org/tag/deployment/" rel="tag">deployment</a>, <a href="http://www.harryjohn.org/tag/powercli/" rel="tag">PowerCLI</a>, <a href="http://www.harryjohn.org/tag/scripts/" rel="tag">scripts</a>, <a href="http://www.harryjohn.org/tag/vmware/" rel="tag">VMware</a>. Bookmark the <a href="http://www.harryjohn.org/deploy-multiple-vms-from-template/" title="Permalink to Deploy multiple VMs from template with PowerCLI" rel="bookmark">permalink</a>.
			</footer><!-- .entry-meta -->
    </div>
    <div class="clearfix shadowfix"></div>
  </div>
</article><!-- #post-204 -->

					<nav id="nav-below">
		<h1 class="assistive-text section-heading">Post navigation</h1>

	
		<div class="nav-previous"><a href="http://www.harryjohn.org/equallogic-vmware-iscsi-setup-part-3-powerconnect-configuration/" rel="prev"><span class="meta-nav">&larr; Previous</span></a></div>		<div class="nav-next"><a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/" rel="next"><span class="meta-nav">Next &rarr;</span></a></div>
	
	</nav><!-- #nav-below -->
	
					<div id="comments">
	
	
			<h2 id="comments-title">
			One thought on &ldquo;<span>Deploy multiple VMs from template with PowerCLI</span>&rdquo;		</h2>

		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-799">
		<article id="comment-799">
			<footer class="clearfix comment-head">
				<div class="comment-author vcard">
					<img alt='' src='http://1.gravatar.com/avatar/786ed2f89de6a867d6df15412883270c?s=40&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/786ed2f89de6a867d6df15412883270c?s=80&amp;d=mm&amp;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' />					<cite class="fn">bvi1998</cite>				</div><!-- .comment-author .vcard -->
				
				<div class="comment-meta commentmetadata">
					<a href="http://www.harryjohn.org/deploy-multiple-vms-from-template/#comment-799"><time pubdate datetime="2014-01-21T21:00:56+00:00">
					January 21, 2014 at 9:00 pm					</time></a>
									</div><!-- .comment-meta .commentmetadata -->
			</footer>

			<div class="comment-content"><p>Hi,<br />
Thanks for sharing the script! I am having trouble with the job calling the deployvm script, it does not seem to have the machinename or datastore at that point. Can you explain the following?<br />
&#8211; when you set the job up, where are you getting all of those arguments?<br />
&#8211; when the job is started, more parameters are sent &#8211; haven&#8217;t they already been set up when you set up the job?<br />
&#8211;  the deployvm script seems to be waiting for different named parameters</p>
<p>Sorry it&#8217;s just that I am not experienced enough in PS to understand all of this, though I have tried. Does the script run for you? </p>
<p>Thanks!</p>
</div>

			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.harryjohn.org/deploy-multiple-vms-from-template/?replytocom=799#respond' onclick='return addComment.moveForm( "comment-799", "799", "respond", "204" )' aria-label='Reply to bvi1998'>Reply</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol>

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/deploy-multiple-vms-from-template/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="http://www.harryjohn.org/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='204' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="3670e62e87" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="79"/></p>			</form>
			</div><!-- #respond -->
	
</div><!-- #comments -->

			
        </div> <!-- end #main -->

        		<div id="sidebar" class="widget-area col300" role="complementary">
        	<div id="social-media" class="clearfix">
				                 
                   
                                                                            </div>

			<aside id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://www.harryjohn.org/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h2 class="widget-title">Recent Posts</h2>		<ul>
					<li>
				<a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/">Office 2016 Install &#8211; &#8220;We need to remove some older apps&#8221;</a>
						</li>
					<li>
				<a href="http://www.harryjohn.org/deploy-multiple-vms-from-template/">Deploy multiple VMs from template with PowerCLI</a>
						</li>
					<li>
				<a href="http://www.harryjohn.org/equallogic-vmware-iscsi-setup-part-3-powerconnect-configuration/">EqualLogic VMware iSCSI Setup &#8211; Part 3: PowerConnect Configuration</a>
						</li>
					<li>
				<a href="http://www.harryjohn.org/equallogic-vmware-iscsi-setup-part-2-network/">EqualLogic VMware iSCSI Setup &#8211; Part 2: Network Configuration</a>
						</li>
					<li>
				<a href="http://www.harryjohn.org/veeam-backup-job-failed-cannot-create-a-shadow-copy-of-the-volumes-containing-writers-data/">Veeam Backup job failed. Cannot create a shadow copy of the volumes containing writer&#8217;s data.</a>
						</li>
				</ul>
		</aside>		<aside id="recent-comments-2" class="widget widget_recent_comments"><h2 class="widget-title">Recent Comments</h2><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://www.universaltech.com.au' rel='external nofollow' class='url'>Rabin</a></span> on <a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/#comment-36046">Office 2016 Install &#8211; &#8220;We need to remove some older apps&#8221;</a></li><li class="recentcomments"><span class="comment-author-link">Phil</span> on <a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/#comment-35654">Office 2016 Install &#8211; &#8220;We need to remove some older apps&#8221;</a></li><li class="recentcomments"><span class="comment-author-link">MG</span> on <a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/#comment-35340">Office 2016 Install &#8211; &#8220;We need to remove some older apps&#8221;</a></li><li class="recentcomments"><span class="comment-author-link">Vince F</span> on <a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/#comment-35159">Office 2016 Install &#8211; &#8220;We need to remove some older apps&#8221;</a></li><li class="recentcomments"><span class="comment-author-link">Steve</span> on <a href="http://www.harryjohn.org/office-2016-install-we-need-to-remove-some-older-apps/#comment-35066">Office 2016 Install &#8211; &#8220;We need to remove some older apps&#8221;</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h2 class="widget-title">Archives</h2>		<ul>
			<li><a href='http://www.harryjohn.org/2015/09/'>September 2015</a></li>
	<li><a href='http://www.harryjohn.org/2014/01/'>January 2014</a></li>
	<li><a href='http://www.harryjohn.org/2013/12/'>December 2013</a></li>
	<li><a href='http://www.harryjohn.org/2013/02/'>February 2013</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h2 class="widget-title">Categories</h2>		<ul>
	<li class="cat-item cat-item-3"><a href="http://www.harryjohn.org/category/equallogic-vmware-iscsi-setup/" >EqualLogic VMware iSCSI Setup</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://www.harryjohn.org/category/powercli/" >PowerCLI</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://www.harryjohn.org/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://www.harryjohn.org/category/vmware/" >VMware</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h2 class="widget-title">Meta</h2>			<ul>
						<li><a rel="nofollow" href="http://www.harryjohn.org/wp-login.php">Log in</a></li>
			<li><a href="http://www.harryjohn.org/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://www.harryjohn.org/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>		</div><!-- #sidebar .widget-area -->

    </div> <!-- end #content -->
        

</div><!-- #container -->

<footer id="colophon" role="contentinfo">
    <div id="site-generator">
        &copy; Harry John		    </div>
</footer><!-- #colophon -->

<script type='text/javascript' src='http://www.harryjohn.org/wp-content/plugins/akismet/_inc/form.js?ver=3.3'></script>
<script type='text/javascript' src='http://www.harryjohn.org/wp-includes/js/wp-embed.min.js?ver=4.7.8'></script>
<script type='text/javascript' src='http://www.harryjohn.org/wp-includes/js/comment-reply.min.js?ver=4.7.8'></script>

</body>
</html>